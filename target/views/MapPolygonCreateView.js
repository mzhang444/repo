define(["ember","utils/utils"],function(e,t){var n=e.View.extend({polygonIsClosed:"",mapOptions:{center:new google.maps.LatLng(37.222,23.1223),zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP},polygonOptions:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.5},init:function(){this.set("polygonIsClosed",!1),this._super.apply(this,arguments)},didInsertElement:function(){this.drawPolygon()},markersDidChange:function(){this.drawPolygon()}.observes("this.controller.markers"),updateMarkers:function(e){var t=e.getPath().getArray(),n=t.map(function(e){return[e.lat(),e.lng()]});this.set("controller.markers",n)},drawPolygon:function(){var e=this.get("controller.markers.length")>0,t=new google.maps.Map(this.$().get(0),this.get("mapOptions"));if(this.lat&&this.lng){var n=new google.maps.LatLng(this.lat,this.lng);t.setCenter(n),t.setZoom(9)}e?this.showPolygon(t):(this.set("polygonIsClosed",!1),this.setupPolygon(t))},closePolygon:function(n,r){t.assert(!e.isNone(r),"Polygon is not defined");var i=r.getPath(),s;r.setMap(null),s=new google.maps.Polygon({map:n,path:i}),s.setOptions(this.polygonOptions),this.updateMarkers(s)},showPolygon:function(n){t.assert(!e.isNone(n),"Map is not defined");var r=[],i,s=new google.maps.Polygon(this.get("polygonOptions"));this.get("controller.markers").forEach(function(e){i=new google.maps.LatLng(e[0],e[1]),r.push(i)}),s.setPath(r),s.setMap(n)},setupPolygon:function(e){var t=this,n=new google.maps.Polyline(this.get("polygonOptions"));n.setMap(e),google.maps.event.addListener(e,"click",function(r){if(t.get("polygonIsClosed"))return;var i=n.getPath().length,s=i===0,o=new google.maps.Marker({map:e,position:r.latLng,draggable:!1});google.maps.event.addListener(o,"click",function(){s&&!t.get("polygonIsClosed")&&n.getPath().length>=3&&(t.closePolygon(e,n),t.set("polygonIsClosed",!0))}),n.getPath().push(r.latLng)})},latLngDidChange:function(){this.drawPolygon()}.observes("this.lat","this.lng")});return n});