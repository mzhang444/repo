define(["ember","models/Errors","utils/utils"],function(e,t,n){var r=e.ObjectController.extend({needs:["application"],error:"",markers:"",init:function(){this.set("error",t.create()),this._super.apply(this,arguments),this.set("markers",[])},clearMapPolygon:function(){this.set("markers",[])},createCrisis:function(){var e={type:"crisisCreate",title:this.get("title"),descr:this.get("descr"),lat:this.get("lat"),lng:this.get("lng"),cityID:this.get("cityID"),countryID:this.get("countryID"),markers:this.get("markers")};this.pushPayloadToServer(e)},pushPayloadToServer:function(e){var t=this,r=n.validatePayload(e),i=n.ERRORS.get("VALIDATION_ERR_CODE"),s;s=function(e){var r=n.ERRORS.get("CLAIM_ERR_CODE"),i=n.ERRORS.get("CLAIM_ERR_MSG");e.error?t.error.addError(r,i):(t.error.resolveError(r),t.set("model.id",e.ID),t.transitionToRoute("crisis",t.get("model")))},r.valid?(this.error.resolveError(i),n.ajax.makeAJAXPostCall("router.php",e,s)):this.error.addError(i,r.message)},userCanCreate:function(){return this.get("controllers.application.user.isLoggedIn")}.property("controllers.application.user.isLoggedIn"),calcLatLng:function(){if(this.get("markers.length")){var e,t,n,r;e=this.get("markers").map(function(e){return e[0]}),t=this.get("markers").map(function(e){return e[1]}),n=e.reduce(function(e,t){return e+t},0)/e.length,r=t.reduce(function(e,t){return e+t},0)/t.length,this.set("lat",n),this.set("lng",r)}}.observes("this.markers"),close:function(){window.history.back()},updateLocationInfo:function(t){n.assert(!e.isNone(t),"Location Info is undefined!"),this.set("lat",t.lat),this.set("lng",t.lng),this.set("country",t.country),this.set("countryID",t.countryID),this.set("cityID",t.id)},cityDidChange:function(){this.get("city")||this.set("country","")}.observes("this.city"),geoData:function(){return this.get("controllers.application.geoData")}.property("controllers.application.geoData")});return r});