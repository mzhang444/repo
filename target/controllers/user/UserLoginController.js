define(["ember","models/Errors","utils/utils"],function(e,t,n){var r=e.ObjectController.extend({needs:["application"],contentBinding:"controllers.application.user",init:function(){this.set("error",t.create());var e=this.get("attemptedTransition"),r=n.ERRORS.get("SIGN_IN_ERR_CODE"),i=n.ERRORS.get("SIGN_IN_ERR_MSG");e&&this.get("error").addError(r,i)},goToAppropriateRoute:function(){var e=this.get("attemptedTransition");e?(e.retry(),this.set("attemptedTransition",null)):this.transitionToRoute("index")},reset:function(){this.setProperties({email:"",password:"",error:t.create()})},login:function(){var t=this,r={type:"login",login:this.get("email"),password:this.get("password")},i=n.validatePayload(r),s=n.ERRORS.get("VALIDATION_ERR_CODE"),o=function(e){var r=n.ERRORS.get("LOGIN_ERR_CODE"),i=n.ERRORS.get("LOGIN_ERR_MSG");e.error?t.error.addError(r,i):(t.error.resolveError(r),t.set("isLoggedIn",!0),t.setProperties(e.element),t.goToAppropriateRoute())};i.valid?(this.error.resolveError(s),e.$.post("router.php",r).then(o)):this.error.addError(s,i.message)}});return r});