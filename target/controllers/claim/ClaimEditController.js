define(["ember","models/Errors","utils/utils"],function(e,t,n){var r=e.ObjectController.extend({needs:["crisis","application"],error:"",init:function(){this.set("error",t.create()),this._super.apply(this,arguments)},userCanCreate:function(){return this.get("controllers.application.user.isLoggedIn")}.property("controllers.application.user.isLoggedIn"),parentCrisisID:function(){return this.get("controllers.crisis.crisisID")}.property("controllers.crisis.crisisID"),updateClaim:function(){var e={type:"claimEdit",ID:this.get("id"),crisisID:this.get("parentCrisisID"),title:this.get("title"),descr:this.get("descr"),lat:this.get("lat"),lng:this.get("lng"),street:this.get("street"),cityID:this.get("cityID"),countryID:this.get("countryID"),tags:[]};this.pushPayloadToServer(e)},calcLatLng:function(){if(this.get("markers.length")){var e,t,n,r;e=this.get("markers").map(function(e){return e[0]}),t=this.get("markers").map(function(e){return e[1]}),n=e.reduce(function(e,t){return e+t},0)/e.length,r=t.reduce(function(e,t){return e+t},0)/t.length,this.set("lat",n),this.set("lng",r)}}.observes("this.markers"),clearMapPolygon:function(){this.set("markers",[])},pushPayloadToServer:function(e){var t=this,r=n.validatePayload(e),i=n.ERRORS.get("VALIDATION_ERR_CODE"),s=function(e){var r=n.ERRORS.get("CLAIM_ERR_CODE"),i=n.ERRORS.get("CLAIM_ERR_MSG");e.error?t.error.addError(r,i):(t.error.resolveError(r),t.transitionToRoute("claim",t.get("model")))};r.valid?(this.error.resolveError(i),n.ajax.makeAJAXPostCall("router.php",e,s)):this.error.addError(i,r.message)},close:function(){this.transitionToRoute("claim")},updateLocationInfo:function(t){n.assert(!e.isNone(t),"Location Info is undefined!"),this.set("lat",t.lat),this.set("lng",t.lng),this.set("country",t.country),this.set("countryID",t.countryID),this.set("cityID",t.id)},geoData:function(){return this.get("controllers.application.geoData")}.property("controllers.application.geoData"),tagsData:function(){return this.get("controllers.application.tags")}.property("controllers.application.tags"),city:function(){var e=this.get("cityID"),t="";return e&&(t=n.getCityName(e,this.get("geoData"))),t}.property("this.cityID")});return r});