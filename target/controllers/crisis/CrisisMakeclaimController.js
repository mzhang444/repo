define(["ember","models/Errors","utils/utils"],function(e,t,n){var r=e.ObjectController.extend({error:"",needs:["crisis","application"],tags:"",city:"",imageIDs:"",init:function(){this.set("tags",[]),this.set("imageIDs",[]),this.set("city",""),this.set("error",t.create()),this._super.apply(this,arguments)},makeClaim:function(){var e={type:"claimCreate",crisisID:this.get("parentCrisisID"),title:this.get("title"),descr:this.get("descr"),lat:this.get("lat"),lng:this.get("lng"),street:this.get("street"),cityID:this.get("cityID"),countryID:this.get("countryID"),tags:this.getTagIDs(),images:this.get("imageIDs")};this.pushPayloadToServer(e)},getTagIDs:function(){var e=this.get("tags"),t=this.get("tagsData"),n=[];return e&&t&&t.forEach(function(t){$.inArray(t.name,e)!==-1&&n.push(t.id)}),n},pushPayloadToServer:function(e){var t=this,r=n.validatePayload(e),i=n.ERRORS.get("VALIDATION_ERR_CODE"),s=function(e){var r=n.ERRORS.get("CLAIM_ERR_CODE"),i=n.ERRORS.get("CLAIM_ERR_MSG");e.error?t.error.addError(r,i):(t.error.resolveError(r),t.set("model.id",e.ID),t.transitionToRoute("claim",t.get("model")))};r.valid?(this.error.resolveError(i),n.ajax.makeAJAXPostCall("router.php",e,s)):this.error.addError(i,r.message)},updateLocationInfo:function(t){n.assert(!e.isNone(t),"Location Info is undefined!"),this.set("mapCentreLat",t.lat),this.set("mapCentreLng",t.lng),this.set("country",t.country),this.set("countryID",t.countryID),this.set("cityID",t.id)},userCanCreate:function(){return this.get("controllers.application.user.isLoggedIn")}.property("controllers.application.user.isLoggedIn"),parentCrisisID:function(){return this.get("controllers.crisis.crisisID")}.property("controllers.crisis.crisisID"),parentCrisisName:function(){return this.get("controllers.crisis.title")}.property("controllers.crisis.title"),mapCentreLat:function(){var e=this.get("centreLat")||this.get("controllers.crisis.lat");return e}.property("controllers.crisis.title","this.centreLat"),mapCentreLng:function(){var e=this.get("centreLng")||this.get("controllers.crisis.lng");return e}.property("controllers.crisis.title","this.centreLng"),close:function(){var e;e=this.get("controllers.crisis.content"),this.transitionToRoute("crisis",e)},geoData:function(){return this.get("controllers.application.geoData")}.property("controllers.application.geoData"),tagsData:function(){return this.get("controllers.application.tags")}.property("controllers.application.tags")});return r});